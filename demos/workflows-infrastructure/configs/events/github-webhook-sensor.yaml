apiVersion: argoproj.io/v1alpha1
kind: Sensor
metadata:
  name: github-webhook-sensor
spec:
  dependencies:
    - name: github-webhook
      eventSourceName: github-webhook-source
      eventName: github
      filters:
        data:
        - path: '[body.action,body.issue.labels.#(name="upgrade").name,body.issue.labels.#(name="approved").name,body.issue.labels.#.name,body.label.name]'
          type: string
          value:
            - '"labeled","upgrade","approved","cluster/.*","approved"'
        - path: '[body.action,body.issue.labels.#(name="upgrade").name,body.issue.labels.#(name="approved").name,body.issue.labels.#.name,body.label.name]'
          type: string
          value:
            - '"labeled","upgrade","approved","account/.*","approved"'

  triggers:
    - template:
        conditions: "github-webhook"
        name: upgrade-cluster-trigger
        log: {} # debug